<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cetistapp v3.0 | Schoolog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: white; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .animate-zoom { animation: zoom 0.3s ease-out; }
        @keyframes zoom { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="pb-24">

    <div id="sidebar" class="fixed top-0 left-0 h-full w-64 glass z-[300] -translate-x-full transition-transform duration-300">
        <div class="p-6 border-b border-white/10 text-center">
            <h2 class="text-sky-400 font-black text-xl">Schoolog</h2>
            <p id="nav-email" class="text-[10px] text-slate-400 truncate mt-1"></p>
        </div>
        <nav class="p-4 space-y-2">
            <button onclick="irA('ini')" class="w-full text-left p-3 rounded-xl hover:bg-white/5 font-bold">üè† Inicio</button>
            <button onclick="irA('for')" class="w-full text-left p-3 rounded-xl hover:bg-white/5 font-bold">üí¨ Foro</button>
            <button onclick="irA('cue')" class="w-full text-left p-3 rounded-xl hover:bg-white/5 font-bold">üë§ Perfil</button>
            <button onclick="cerrarSesion()" class="w-full text-left p-3 text-rose-500 font-bold mt-10">üö™ Salir</button>
        </nav>
    </div>

    <main class="p-4 max-w-md mx-auto">
        <section id="sec-login" class="pt-20 space-y-6">
            <div class="text-center">
                <h1 class="text-5xl font-black tracking-tighter">Cetistapp</h1>
                <p class="text-sky-500 font-bold text-xs tracking-widest uppercase">By Schoolog</p>
            </div>
            <div class="glass p-6 rounded-[2rem] space-y-4">
                <input type="email" id="log-email" placeholder="Correo" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 outline-none">
                <input type="password" id="log-pass" placeholder="Contrase√±a" class="w-full p-4 rounded-xl bg-white/5 border border-white/10 outline-none">
                <button onclick="login()" class="w-full bg-sky-500 text-slate-950 p-4 rounded-xl font-black uppercase shadow-lg shadow-sky-500/20">Entrar</button>
                <button onclick="registro()" class="w-full text-slate-500 text-[10px] font-bold uppercase tracking-widest text-center">Crear cuenta nueva</button>
            </div>
        </section>

        <section id="sec-ini" class="hidden animate-zoom pt-10">
            <h1 class="text-3xl font-black mb-4">¬°Qu√© onda!</h1>
            <div class="glass p-6 rounded-3xl border-none bg-gradient-to-br from-sky-500/20 to-transparent">
                <p id="frase" class="italic text-slate-300">"El √©xito es la suma de peque√±os esfuerzos diarios."</p>
            </div>
        </section>

        <section id="sec-for" class="hidden animate-zoom space-y-4">
            <div class="glass p-4 rounded-2xl">
                <textarea id="f-txt" placeholder="¬øQu√© hay de nuevo?" class="w-full p-3 rounded-lg bg-white/5 text-sm h-20 outline-none mb-2"></textarea>
                <div class="flex gap-2 mb-2">
                    <button onclick="window.prio='alta'" class="flex-1 p-2 rounded-lg border border-rose-500 text-rose-500 text-[10px] font-bold">URGENTE</button>
                    <button onclick="window.prio='baja'" class="flex-1 p-2 rounded-lg border border-slate-500 text-slate-400 text-[10px] font-bold">NORMAL</button>
                </div>
                <button onclick="publicar()" class="w-full bg-white text-slate-900 p-3 rounded-xl font-black text-xs">PUBLICAR</button>
            </div>
            <div id="feed" class="space-y-3"></div>
        </section>

        <section id="sec-cue" class="hidden animate-zoom text-center">
            <div class="glass p-8 rounded-[2.5rem]">
                <div id="p-foto" class="w-24 h-24 rounded-full bg-slate-800 mx-auto mb-4 border-2 border-sky-500 overflow-hidden"></div>
                <h2 id="p-nombre" class="font-bold mb-4">Usuario</h2>
                <input type="text" id="p-url" placeholder="Pega link de foto aqu√≠" class="w-full p-3 rounded-lg bg-white/5 border border-white/10 text-xs mb-4">
                <button onclick="subirFoto()" class="w-full bg-sky-500 text-slate-950 p-3 rounded-xl font-bold text-xs uppercase">Guardar Perfil</button>
                <p class="text-[9px] text-slate-600 mt-10 font-black uppercase tracking-widest">Desarrollado por N.A. & Gemini</p>
            </div>
        </section>
    </main>

    <div id="nav-bar" class="fixed bottom-0 left-0 w-full h-20 glass border-t border-white/5 flex items-center justify-around hidden">
        <button onclick="irA('ini')" class="text-xl">üè†</button>
        <button onclick="irA('for')" class="text-xl">üí¨</button>
        <button onclick="toggleSidebar()" class="w-12 h-12 bg-sky-500 rounded-full text-slate-950 font-bold">‚ò∞</button>
        <button onclick="irA('cue')" class="text-xl">üë§</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBliPWrdCDZzlFDIdsI17fyINeW-TsMgr0",
            authDomain: "schoolog-ee12b.firebaseapp.com",
            databaseURL: "https://schoolog-ee12b-default-rtdb.firebaseio.com",
            projectId: "schoolog-ee12b",
            storageBucket: "schoolog-ee12b.firebasestorage.app",
            messagingSenderId: "11132093202",
            appId: "1:11132093202:web:fe1f1d743eb0fb398529cb"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        window.prio = 'baja';

        window.registro = () => {
            const e = document.getElementById('log-email').value, p = document.getElementById('log-pass').value;
            if(!e || !p) return alert("Llena los campos");
            createUserWithEmailAndPassword(auth, e, p).catch(err => alert("Error: " + err.message));
        };

        window.login = () => {
            const e = document.getElementById('log-email').value, p = document.getElementById('log-pass').value;
            if(!e || !p) return alert("Llena los campos");
            signInWithEmailAndPassword(auth, e, p).catch(() => alert("Datos incorrectos"));
        };

        window.cerrarSesion = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, (u) => {
            if (u) {
                document.getElementById('nav-bar').classList.remove('hidden');
                document.getElementById('sec-login').classList.add('hidden');
                document.getElementById('nav-email').innerText = u.email;
                conectar(u);
                irA('ini');
            }
        });

        window.irA = (s) => {
            document.querySelectorAll('main > section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById('sec-' + s).classList.remove('hidden');
            document.getElementById('sidebar').classList.add('-translate-x-full');
        };

        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('-translate-x-full');

        function conectar(u) {
            onValue(ref(db, 'usuarios/' + u.uid), (s) => {
                const d = s.val() || {}, f = d.foto || "https://ui-avatars.com/api/?name=" + u.email;
                document.getElementById('p-foto').innerHTML = `<img src="${f}" class="w-full h-full object-cover">`;
                document.getElementById('p-nombre').innerText = u.email.split('@')[0].toUpperCase();
            });
            onValue(ref(db, 'foro/posts'), (s) => {
                const feed = document.getElementById('feed'); feed.innerHTML = "";
                if(s.val()) Object.entries(s.val()).reverse().forEach(([id, p]) => {
                    const cl = p.prio === 'alta' ? 'border-rose-500 animate-pulse' : 'border-white/10';
                    feed.innerHTML += `<div class="glass p-4 rounded-xl border-l-4 ${cl}"><p class="text-[9px] font-black text-sky-400 uppercase">${p.aut}</p><p class="text-xs mt-1">${p.txt}</p></div>`;
                });
            });
        }

        window.publicar = () => {
            const t = document.getElementById('f-txt').value;
            if(!t) return;
            push(ref(db, 'foro/posts'), { aut: auth.currentUser.email.split('@')[0], txt: t, prio: window.prio });
            document.getElementById('f-txt').value = "";
        };

        window.subirFoto = () => {
            const url = document.getElementById('p-url').value;
            if(url) update(ref(db, 'usuarios/' + auth.currentUser.uid), { foto: url }).then(() => alert("¬°Listo!"));
        };
    </script>
</body>
</html>

